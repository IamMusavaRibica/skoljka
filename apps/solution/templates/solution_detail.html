{% extends "base.html" %}

{% load post_tags %}
{% load rating_tags %}

{% block title %}Rješenje zadatka &quot;{{ solution.task.name }}&quot; korisnika &quot;{{ solution.author }}&quot;{% endblock %}

{% block content %}

<div style="float:left;">
  {% if user.is_authenticated %}
    {% if user == solution.author %}
      Točnost: <div style="width:80px;display:inline-block;">{% rating_stars manager=solution.correctness red_if_lt=2.0 %}</div>
    {% else %}
      {% rating_box "Točnost" solution.correctness %}
    {% endif %}
  {% endif %}
</div>
<div style="float:right;text-align:right;">
  {{ solution.date_created }} ({{ solution.date_created|timesince }})<br>
  {% if solution.author == user or user.is_staff or solution.task.author == user %}
    <form action="/solution/{{ solution.pk }}/edit/mark/" method="post">
      {% csrf_token %}
      <div class="btn-group">
        {% if user.is_staff or solution.task.author == user %}
          {% if solution.is_official %}
            <button class="btn btn-mini" name="action" value="official0">Makni oznaku službenog</button>
          {% else %}
            <button class="btn btn-mini" name="action" value="official1">Označi kao službeno</button>
          {% endif %}
        {% endif %}
        {% ifequal solution.author.id user.id %}
          <button class="btn btn-mini" name="action" value="blank" title="Staro rješenje će ostati spremljeno za ponovno slanje, ali neće biti inače vidljivo.">Izbriši rješenje</button>
          <button class="btn btn-mini" name="action" value="as_solved" title="Tekst rješenja neće biti vidljiv.">Označi kao riješeno</button>
          <button class="btn btn-mini" name="action" value="todo" title="Tekst rješenja neće biti vidljiv.">To Do</button>
          <a class="btn btn-mini" href="/solution/{{ solution.pk }}/edit/">Uredi</a>
        {% endifequal %}
      </div>
    </form>
  {% endif %}
  {% if solution.is_official %}
    <span class="label label-info">Službeno rješenje</span>
  {% endif %}
</div>


<br><br>
<i>Korisnik: {{ solution.author|userlink }}</i><br>
<i>Zadatak: {{ solution.task.get_link }}</i>
<a href="#" id="solution-toggle-task">
  (Sakrij tekst zadatka)
</a>

<br><br>

<div class="well" id="solution-task">
  {# TODO: DRY? render conditionally tag? #}
  {% if user.is_authenticated %}
    {{ solution.task.content.render_quote }}
  {% else %}
    {{ solution.task.content.render }}
  {% endif %}
</div>

<div class="well" id="solution-container">
  {% if obfuscate %}
    <div id="solution-unhide-box">
      <div class="center-vertically">
        <div>
          <div>
            Upozorenje: Ovaj zadatak još niste riješili!<br>
            Kliknite ovdje kako biste prikazali rješenje.
          </div>
        </div>
      </div>
    </div>
    <div id="solution-inner-container" style="visibility: hidden;">
  {% endif %}

  {# TODO: render tag! #}
  {% if user.is_authenticated %}
    {{ solution.content.render_quote }}
  {% else %}
    {{ solution.content.render }}
  {% endif %}

  {% if obfuscate %}
    </div> {# solution-inner-container #}
  {% endif %}
</div>

{% if solution.correctness_avg %}
  <br>
  <h5><a href="#" id="solution-ratings-toggle">Ocjene: ({{ ratings|length }})</a></h5>
  <table class="table-striped table-condensed" style="text-align:center;width:400px;display:none;" id="solution-ratings">
  {% for x in ratings %}
    <tr>
      <td style="width:140px;">{{ x.date }}</td>
      <td>{{ x.user|userlink }}</td>
      <td style="width:80px;">{% rating_stars manager=solution.correctness red_if_lt=2.0 value=x.value %}</td>
    </tr>
  {% endfor %}
  </table>
{% endif %}
<br><br><br>
{% show_posts_small solution %}

{% endblock content %}
