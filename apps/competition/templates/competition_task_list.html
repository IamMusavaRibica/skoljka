{% extends "competition_base.html" %}

{% load competition_tags %}

{% block content %}
<h3 class="comp-header">Zadaci</h3>

{% if not has_started %}
  <div class="alert">
    Natjecanje još nije počelo!
  </div>

  {% if is_admin %}
    <div class="alert">
      Trenutačno vidljivo samo administratorima!
    </div>
  {% endif %}
{% endif %}

{% if has_started or is_admin %}
  <table id="comp-tasks">
    {% for name, category in categories.iteritems %}
      {# hidden visible only if admin #}
      <tr class="comp-category {{ category.t_is_hidden|yesno:"comp-category-hidden," }}">
        <td colspan="2">
          {{ name }}
        </td>
      </tr>
      {% for chain in category.chains %}
        {# hidden visible only if admin #}
        <tr class="comp-chain
            {% if chain.t_is_hidden and has_started %}comp-chain-hidden{% endif %}">
          <td class="comp-chain-name">{{ chain.name }}</td>
          <td class="comp-chain-tasks">
            {% comment %}
            {% for ctask in chain.ctasks %}
              <a class="ctask-bubble {% ctask_bubble_class ctask %}"
                href="{{ ctask.get_absolute_url }}"></a>
            {% endfor %}
            {% endcomment %}
            <div class="progress"
                style="width: {% percentage chain.ctasks|length max_chain_length %}">
              {% for ctask in chain.ctasks %}
                {% if not ctask.t_is_locked or is_admin %}
                  <a class="ctask {% ctask_class ctask %}"
                      style="width: {% percentage 1 chain.ctasks|length %}"
                      href="{{ ctask.get_absolute_url }}"></a>
                {% else %}
                  <div class="ctask {% ctask_class ctask %}"
                      style="width: {% percentage 1 chain.ctasks|length %}">
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </td>
          <td class="comp-chain-bonus">
            {% if chain.bonus_score %}
              <div class="badge {% chain_badge_class chain %}">
                +{{ chain.bonus_score }}
              </div>
            {% else %}
              &nbsp;
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    {% endfor %}
  </table>

  <div id="ctask-legend-container">
    <a href="#" title="Prikaži/sakrij legendu" class="auto-toggler"
        data-target="ctask-legend">Legenda</a>
    <br>
    <div id="ctask-legend" style="display: none;">
      <div class="row row-fix">
        <div class="span5">
          <table>
            {% legend_ctask "bar ctask-solved" "Uspješno riješen zadatak" %}
            {% legend_ctask "bar ctask-failed" "Iskorišteni svi pokušaji" %}
            {% legend_ctask "bar ctask-open" "Otvoren zadatak" %}
            {% legend_ctask "bar ctask-tried" "Zadatak s neuspjelim pokušajem" %}
            {% legend_ctask "ctask-locked" "Zaključan zadatak" %}
            {% legend_chain "badge-success" "Osvojen bonus" %}
            {% legend_chain "" "Bonus više nije dostupan" %}
            {% legend_chain "badge-info" "Bonus dostupan, ali nije osvojen" %}
          </table>
        </div>
      </div>
    </div>
  </div>
{% endif %}

{% endblock content %}
