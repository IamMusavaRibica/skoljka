{% extends "competition_base.html" %}

{% load competition_tags %}

{% block content %}

{# This template not reachable for has_finished=True case. #}

{% if competition.registration_open_date > current_time %}
  <h3 class="comp-header">Registracija</h3>
  <div class="alert">Registracije još nisu otvorene! </div>

  {% if is_admin %}
    <div class="alert">Trenutačno vidljivo samo administratorima! </div>
  {% endif %}
{% endif %}

{% if 'created' in request.GET %}
  <div class="alert alert-success">Registracija uspješna! </div>
{% endif %}

{% if 'changes' in request.GET %}
  <div class="alert alert-success">Izmjene spremljene!</div>
{% endif %}

{% if current_time >= competition.registration_open_date or is_admin %}
  {% if not has_finished and not team and team_invitations %}
    <h3 class="comp-header">Pozivnice</h3>
    <form action="{{ requst.get_full_path }}" method="POST" class="row row-fix">
      {% csrf_token %}
      <table id="creg-invitations-table" class="span6">
        <tr>
          <th>Tim</th>
          <th>Osnivač</th>
          <th>&nbsp;</th>
        </tr>
        {% for tm in team_invitations %}
          <tr>
            <td>{{ tm.name }}</td>
            <td>{{ tm.author|userlink }}</td>
            <td>
              <button type="submit" name="invitation-accept" class="btn"
                  value="{{ tm.id }}">
                Prihvati
              </button>
            </td>
          </tr>
        {% endfor %}
      </table>
    </form>
  {% endif %}

  {% if team_form %}
    {% if team %}
      <h3 class="comp-header">Uređivanje tima</h3>
    {% else %}
      <h3 class="comp-header">Registracija tima</h3>
    {% endif %}

    <div class="instructions">
      <p>U prvo polje unesite željeno ime tima.</p>
      <p>Drugi i treće polje predstavljaju imena drugih članova tima. Ukoliko
        želite samo navesti njihova imena, unesite ih u ta polja.</p>
      <p>Ako pak oni imaju korisnički račun, možete ih povezati pritiskom na
        tipku <i>Pozovi</i>. Nakon što odaberete odgovarajuća korisnička imena
        i pritisnite <i>Pošalji</i>, odabranim korisnicima će se poslati
        pozivnice za priključivanje vašem timu.</p>
      <p>Ti korisnici prihvaćaju pozivnice na način da se prijave na vlastiti
        račun te na istoj ovoj stranici pritisnu na <i>Prihvati</i>.</p>
    </div>

    {% reg_available_users %}

    <form action="{{ request.get_full_path }}" method="POST" id="creg-form">
      {% csrf_token %}
      {{ team_form.name.errors }}
      <div id="creg-table">
        <div>
          <div>Ime tima:</div>
          <div>{{ team_form.name }}</div>
          {# <div>&nbsp;</div> #}
        </div>
      </div>
      {% reg_add_member_fields %}
      <script>
        reg_add_listeners();
      </script>
      <br>
      <input type="submit" class="btn btn-primary" value="Pošalji">
    </form>
  {% elif team %}
    {% include 'inc_competition_team_detail.html' with preview_team=team preview_team_members=team_members %}
  {% endif %}
{% endif %} {# registration open or is_admin #}

{% if is_admin and not has_private_team %}
  <br>
  <div class="alert">
    As an administrator, you can create a private admin team used for reviewing
    the tasks. In parallel to that team, you can have a normal team (NOT YET).
    Switching between the teams will be available in the menu.

    <form method="POST" action="{{ request.get_full_path }}">
      {% csrf_token %}
      <button type="submit" name="create-admin-private-team" value="1">
        Create the private team
      </button>
    </form>
  </div>
{% endif %}

{% endblock content %}
